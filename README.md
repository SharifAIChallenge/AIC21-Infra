# AIC21-Infra

## components
- [saint_peters_gate](https://github.com/SharifAIChallenge/AIC21-infra-saint_peters_gate): AIC21-infra gateway
- [compiler](https://github.com/SharifAIChallenge/AIC21-infra-compiler): a service that would compile contestants raw code and store the generated binary in the shared storage
- [final_judgement](https://github.com/SharifAIChallenge/AIC21-infra-final_judgement): a service that would hold the matches between two contestants
- [hermes](https://github.com/SharifAIChallenge/AIC21-infra-hermes): event broker: sends generated events (mainly by [compiler](https://github.com/SharifAIChallenge/AIC21-infra-compiler) and [final_judgement](https://github.com/SharifAIChallenge/AIC21-infra-final_judgement)) to [AIC21-backend](https://github.com/SharifAIChallenge/AIC21-backend)
## Architecture
every request from AIC-backend/contestant is gone through [saint_peters_gate](https://github.com/SharifAIChallenge/AIC21-infra-saint_peters_gate) which acts as our gateway

there are three type of messeges/requests that [saint_peters_gate](https://github.com/SharifAIChallenge/AIC21-infra-saint_peters_gate) accepts:
- register raw code (and further compile it)
- register match
- register map

on arrival of each of the mentioned requests, [saint_peters_gate](https://github.com/SharifAIChallenge/AIC21-infra-saint_peters_gate) would produce a message in a corresponding topic in our kafka cluster, which then would be consumed by their corresponding consumers (i.e. [compiler](https://github.com/SharifAIChallenge/AIC21-infra-compiler) and [final_judgement](https://github.com/SharifAIChallenge/AIC21-infra-final_judgement))
(since registering a map is as simple as saving it in our shared storage, [saint_peters_gate](https://github.com/SharifAIChallenge/AIC21-infra-saint_peters_gate) would do it syncronusly)

any event log generated by the infra component which is important to [AIC21-backend](https://github.com/SharifAIChallenge/AIC21-backend) is produced in a topic in kafka and [hermes](https://github.com/SharifAIChallenge/AIC21-infra-hermes) is responsible to make sure that events are received by [AIC21-backend](https://github.com/SharifAIChallenge/AIC21-backend) 

### details
- our micro service is based on offline processing model and events/task are queued. we used kafka as our event brocker/task queue 
- for storing huge files such as raw code,compiled code, match log,... we used minio which gives us a realiable S3 API to do so
- we used docker-swarm as our orchestrator since the project is small and not very complicated
- you can see docker-swarm stack files and nginx configuration files in [AIC21-configs](https://github.com/SharifAIChallenge/AIC21-infra-configs)
- further details on how every individual module works and how they are connected together can be found in their correspnding READMEs
